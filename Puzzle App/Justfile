# Bridge Training App - Development Commands
# https://github.com/casey/just

# Variables
frontend_dir := "frontend"
puzzle_db_dir := "../Puzzle Database/dynamic_declarer_play_part1"

# Default recipe - show available commands
default:
    @just --list --unsorted

# === Frontend Development ===

# Start the development server
dev:
    @echo "ðŸš€ Starting frontend development server..."
    cd {{frontend_dir}} && npm run dev

# Build the frontend for production
build:
    @echo "ðŸ“¦ Building frontend for production..."
    cd {{frontend_dir}} && npm run build

# Preview production build locally
preview:
    @echo "ðŸ‘€ Previewing production build..."
    cd {{frontend_dir}} && npm run preview

# Run linter
lint:
    @echo "ðŸ” Linting code..."
    cd {{frontend_dir}} && npm run lint

# Install frontend dependencies
install:
    @echo "ðŸ“¥ Installing frontend dependencies..."
    cd {{frontend_dir}} && npm install

# Install a specific package
install-package package:
    @echo "ðŸ“¥ Installing {{package}}..."
    cd {{frontend_dir}} && npm install {{package}}

# === Supabase Database ===

# Start local Supabase (requires Docker)
db-start:
    @echo "ðŸ—„ï¸  Starting local Supabase..."
    npx supabase start

# Stop local Supabase
db-stop:
    @echo "â¹ï¸  Stopping local Supabase..."
    npx supabase stop

# Reset database and run migrations
db-reset:
    @echo "â™»ï¸  Resetting database and running migrations..."
    npx supabase db reset

# Generate TypeScript types from database
db-types:
    @echo "ðŸ“ Generating TypeScript types..."
    npx supabase gen types typescript --local > {{frontend_dir}}/src/types/supabase.ts

# Run database migrations
db-migrate:
    @echo "â¬†ï¸  Running database migrations..."
    npx supabase db push

# === Puzzle Data Management ===

# Migrate puzzle data to Supabase
migrate-puzzles:
    @echo "ðŸŒ‰ Migrating puzzles to Supabase..."
    cd scripts && python3 migrate_puzzles_to_supabase.py

# Check puzzle data integrity
check-puzzles:
    @echo "ðŸ” Checking puzzle data integrity..."
    cd "{{puzzle_db_dir}}" && python3 analyze_completeness.py

# === Git Operations ===

# Add all changes and commit with message
commit message:
    @echo "ðŸ“ Committing changes..."
    git add .
    git commit -m "{{message}}"

# Commit with conventional commit format
commit-feat feature:
    @echo "âœ¨ Committing new feature..."
    git add .
    git commit -m "feat: {{feature}}"

# Commit a bug fix
commit-fix bug:
    @echo "ðŸ› Committing bug fix..."
    git add .
    git commit -m "fix: {{bug}}"

# Commit documentation changes
commit-docs changes:
    @echo "ðŸ“š Committing documentation..."
    git add .
    git commit -m "docs: {{changes}}"

# Push to remote repository
push:
    @echo "â¬†ï¸  Pushing to remote..."
    git push

# Full commit and push workflow
ship message:
    @echo "ðŸš¢ Shipping changes..."
    git add .
    git commit -m "{{message}}"
    git push

# === Deployment ===

# Deploy to Vercel
deploy:
    @echo "ðŸŒ Deploying to Vercel..."
    cd {{frontend_dir}} && vercel --prod --yes

# Build and deploy
build-deploy: build deploy

# === Development Setup ===

# First-time setup
setup:
    @echo "ðŸ› ï¸  Setting up development environment..."
    @just install
    @echo "âœ… Setup complete! Use 'just dev' to start development server"

# Clean all node_modules and reinstall
clean-install:
    @echo "ðŸ§¹ Cleaning and reinstalling dependencies..."
    cd {{frontend_dir}} && rm -rf node_modules package-lock.json
    cd {{frontend_dir}} && npm install

# === Testing & Quality ===

# Run type check
type-check:
    @echo "ðŸ” Running TypeScript type check..."
    cd {{frontend_dir}} && npx tsc --noEmit

# Run all quality checks
check-all:
    @echo "ðŸ§ª Running all quality checks..."
    @just lint
    @just type-check
    @echo "âœ… All checks passed!"

# === Environment Management ===

# Show environment info
env-info:
    @echo "ðŸ“Š Environment Information:"
    @echo "Node version: $(node --version)"
    @echo "npm version: $(npm --version)" 
    @echo "Python version: $(python3 --version)"
    @echo "Current directory: $(pwd)"
    @echo "Git branch: $(git branch --show-current)"

# === Logs & Debugging ===

# View development logs
logs:
    @echo "ðŸ“œ Starting development with logs..."
    cd {{frontend_dir}} && npm run dev --verbose

# Clean build artifacts
clean:
    @echo "ðŸ§¹ Cleaning build artifacts..."
    cd {{frontend_dir}} && rm -rf dist .vite node_modules/.vite

# === Utility Commands ===

# Open app in browser (after starting dev server)
open:
    @echo "ðŸŒ Opening app in browser..."
    open http://localhost:5173

# Generate a new component (requires template)
new-component name:
    @echo "ðŸ§© Creating new component: {{name}}..."
    @echo "// TODO: Implement component template generation"

# Show project stats
stats:
    @echo "ðŸ“ˆ Project Statistics:"
    @echo "Frontend files: $(find {{frontend_dir}}/src -name '*.tsx' -o -name '*.ts' | wc -l | tr -d ' ')"
    @echo "Total lines of code: $(find {{frontend_dir}}/src -name '*.tsx' -o -name '*.ts' -exec cat {} + | wc -l | tr -d ' ')"
    @echo "Dependencies: $(cd {{frontend_dir}} && npm list --depth=0 2>/dev/null | grep -c 'â”€')"

# === Help ===

# Show detailed help for a command
help command:
    @echo "ðŸ“– Help for '{{command}}':"
    @just --show {{command}}

# Show all available commands with descriptions
help-all:
    @just --list